<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>給妳的一封信 — 倒數 & 翻頁驚喜</title>
<style>
  /* Reset & 基本排版 */
  :root {
    --bg1: linear-gradient(120deg,#f8efe6,#fff1f5);
    --accent: #e86b92;
    --paper: #fffefb;
    --text: #333;
  }
  *{box-sizing:border-box}
  body{
    margin:0;font-family: "Noto Sans TC", "Segoe UI", Roboto, system-ui, -apple-system;
    background: var(--bg1); color:var(--text);
    min-height:100vh; display:flex; align-items:center; justify-content:center;
    padding:20px;
  }
  .wrap{width:100%;max-width:980px; position:relative;}

  /* 封面 / 信封 */
  #cover{
    width:100%; height:560px; max-height:75vh; margin:0 auto; display:flex;
    align-items:center; justify-content:center; position:relative; transition:opacity .8s;
  }
  .envelope{
    width:80%; max-width:720px; height:420px; background:linear-gradient(#fff,#fffefc);
    border-radius:12px; box-shadow:0 18px 40px rgba(0,0,0,.12); position:relative;
    display:flex; align-items:center; justify-content:center; flex-direction:column;
    transform-origin:center; transition:transform .9s ease, opacity .6s;
    overflow:hidden;
  }
  .seal{
    position:absolute; top:22px; right:22px; width:72px; height:72px; border-radius:50%;
    background:var(--accent); color:white; display:flex; align-items:center; justify-content:center;
    font-size:28px; box-shadow:0 6px 18px rgba(232,107,146,.35);
  }
  .envelope h1{margin:40px 0 8px; font-size:28px;}
  .envelope p{margin:0; font-size:16px; color: #6b6b6b;}
  #countdown{margin-top:18px; font-weight:700; font-size:18px; letter-spacing:0.4px;}

  /* 開啟時的微動畫 */
  #cover.open .envelope{ transform: translateY(-18px) scale(.995) rotateX(8deg); opacity:.92; }
  #cover.hidden{ opacity:0; pointer-events:none }

  /* 書本區塊（翻頁） */
  #book{ display:none; margin-top:12px; }
  #book.visible{ display:block; animation:fadeIn .6s ease; }
  @keyframes fadeIn{ from{opacity:0; transform:translateY(12px)} to{opacity:1; transform:none} }

  .stage{
    width:100%; max-width:860px; height:520px; margin:0 auto; position:relative; perspective:2200px;
    display:flex; align-items:center; justify-content:center;
  }

  .book{
    width:78%; height:86%; position:relative; transform-style:preserve-3d;
  }

  .page{
    position:absolute; top:0; left:0; width:100%; height:100%;
    background:var(--paper); border-radius:8px; box-shadow: 0 10px 30px rgba(0,0,0,.15);
    transform-origin: right center; transition: transform 1s cubic-bezier(.2,.8,.2,1), box-shadow .3s;
    backface-visibility: hidden; overflow:auto; padding:36px;
    display:flex; flex-direction:column; gap:12px;
  }

  .page .page-title{font-size:22px; font-weight:700; margin-bottom:6px}
  .page .page-body{white-space:pre-wrap; line-height:1.7; font-size:16px; color:#333;}

  /* 翻頁後的樣式（從右往左翻） */
  .page.flipped{
    transform: rotateY(-180deg) translateX(-2%);
    box-shadow: 0 4px 10px rgba(0,0,0,.08);
  }

  /* page 背面（可顯示裝飾） */
  .page::after{
    content:""; position:absolute; inset:0; background:linear-gradient(90deg,#fff,#fff); transform:rotateY(180deg); border-radius:8px;
    backface-visibility:hidden;
  }

  /* 控制鈕 */
  .controls{ margin-top:16px; display:flex; justify-content:center; gap:12px; }
  button.btn{
    border:0; padding:10px 16px; border-radius:8px; font-weight:700; cursor:pointer;
    box-shadow: 0 8px 20px rgba(0,0,0,.08);
  }
  .btn.primary{ background:var(--accent); color:white }
  .btn.ghost{ background:transparent; border:1px solid rgba(0,0,0,.08) }

  /* 管理面板（用來設定日期 & 編輯內容） */
  .admin{
    position:fixed; right:18px; bottom:18px; background:white; padding:12px; border-radius:10px;
    box-shadow:0 10px 30px rgba(0,0,0,.12); font-size:13px; z-index:9999;
  }
  .admin input[type="datetime-local"]{ font-size:13px; padding:6px; border-radius:6px; border:1px solid #eee }
  .admin small{ color:#666; display:block; margin-top:8px }

  /* mobile friendly */
  @media (max-width:720px){
    .envelope{ width:94%; height:360px }
    .stage{ height:420px }
    .book{ width:92% }
  }
</style>
</head>
<body>
<div class="wrap">
  <!-- 封面（倒數 + 開啟） -->
  <div id="cover" aria-hidden="false">
    <div class="envelope">
      <div class="seal">❤</div>
      <h1 id="letterTitle">給妳的一封信</h1>
      <p id="letterSub">還在等 2025-10-05 00:00：倒數開啟</p>
      <div id="countdown">—</div>
      <div style="margin-top:18px">
        <button id="forceOpen" class="btn ghost" title="測試用，會立刻觸發開啟效果">立刻開啟（測試）</button>
        <button id="openHelp" class="btn ghost" style="margin-left:8px">如何編輯內容</button>
      </div>
    </div>
  </div>

  <!-- 書本 / 翻頁區 -->
  <div id="book" class="" aria-hidden="true">
    <div class="stage">
      <div class="book" id="bookInner">
        <!-- 注意：下面的每個 .page 就是一頁，編輯內容請看註解 -->
        <!-- -- 編輯說明：把你想說的文字放到 .page-body 內；或開啟右下角「編輯模式」在瀏覽器內直接修改並儲存 -- -->
        <div class="page" data-page="1">
          <div class="page-title">序 — 致我的最愛</div>
          <div class="page-body" contenteditable="false">親愛的，這一封是藏給妳的驚喜信……（把這段改成你要的文字）</div>
        </div>

        <div class="page" data-page="2">
          <div class="page-title">回憶 — 我們的那些小日子</div>
          <div class="page-body" contenteditable="false">記得那天我們第一次一起看電影…（可以放照片連結或文字）</div>
        </div>

        <div class="page" data-page="3">
          <div class="page-title">願望 — 未來要一起做的事</div>
          <div class="page-body" contenteditable="false">我希望未來能和妳一起…</div>
        </div>

        <div class="page" data-page="4">
          <div class="page-title">結尾 — 永遠的妳</div>
          <div class="page-body" contenteditable="false">生日快樂！愛你的 XX。</div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button id="prevBtn" class="btn ghost">← 上一頁</button>
      <button id="nextBtn" class="btn primary">下一頁 →</button>
    </div>
  </div>
</div>

<!-- 管理小工具：可以設定開啟時間、切換編輯模式、儲存 -->
<div class="admin" aria-hidden="false">
  <div style="display:flex;gap:8px;align-items:center;">
    <label style="font-weight:700">開啟時間</label>
    <input id="openAtInput" type="datetime-local" />
  </div>
  <div style="margin-top:8px;display:flex;gap:8px">
    <button id="editToggle" class="btn ghost">進入編輯模式</button>
    <button id="saveBtn" class="btn primary">儲存內容</button>
  </div>
  <small>編輯後按「儲存內容」會存在你的瀏覽器（localStorage）。要做永久上線，建議直接修改 index.html。</small>
</div>

<script>
/* -------------------------
   Config（要改這裡）
   -------------------------
   設定預設開啟時間（ISO 格式）或在頁面右下角改時間：
*/
const DEFAULT_OPEN_AT_ISO = "2025-10-05T00:00:00+08:00"; // 預設 10/5 台北時間
// -------------------------

// Helper
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));

// DOM
const cover = $('#cover');
const countdownEl = $('#countdown');
const letterSub = $('#letterSub');
const book = $('#book');
const bookInner = $('#bookInner');
const pages = $$('.page');
const nextBtn = $('#nextBtn');
const prevBtn = $('#prevBtn');
const forceOpen = $('#forceOpen');
const openAtInput = $('#openAtInput');
const editToggle = $('#editToggle');
const saveBtn = $('#saveBtn');
const openHelp = $('#openHelp');

let currentIndex = 0; // 已翻的頁數
let targetDate = null;
let countdownTimer = null;
let isEditing = false;

/* -------------------------
   恢復儲存的內容（localStorage）
   我們把文字存在 localStorage['love_pages']（格式：JSON array）
   也把開啟時間存在 localStorage['love_openAt']
   ------------------------- */
function loadSaved(){
  try{
    const saved = localStorage.getItem('love_pages');
    if(saved){
      const arr = JSON.parse(saved);
      arr.forEach((html,i)=>{
        if(pages[i]) pages[i].querySelector('.page-body').innerHTML = html;
      });
    }
    const savedDate = localStorage.getItem('love_openAt');
    if(savedDate){
      targetDate = new Date(savedDate);
    } else {
      targetDate = new Date(DEFAULT_OPEN_AT_ISO);
    }
  }catch(e){
    console.warn('loadSaved error', e);
    targetDate = new Date(DEFAULT_OPEN_AT_ISO);
  }
  // 設定右下的 input（datetime-local 需要轉成 local datetime 格式）
  function toLocalInputIso(d){
    const pad=(n)=>n.toString().padStart(2,'0');
    return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
  }
  openAtInput.value = toLocalInputIso(targetDate);
}
loadSaved();

/* -------------------------
   設定 pages 疊放順序（index 0 在最上層）
   ------------------------- */
pages.forEach((p,i)=>{
  p.style.zIndex = pages.length - i;
});

/* -------------------------
   倒數邏輯（每秒更新）
   ------------------------- */
function updateCountdown(){
  const now = new Date();
  const diff = targetDate - now;
  if(diff <= 0){
    countdownEl.textContent = "已到時間，正在開啟...";
    clearInterval(countdownTimer);
    setTimeout(openCover, 600);
    return;
  }
  const sec = Math.floor(diff/1000);
  const days = Math.floor(sec / (3600*24));
  const hh = Math.floor((sec % (3600*24)) / 3600);
  const mm = Math.floor((sec % 3600) / 60);
  const ss = sec % 60;
  countdownEl.textContent = `${days}天 ${String(hh).padStart(2,'0')}:${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
  letterSub.textContent = `還在等 ${targetDate.toLocaleString()}：倒數開啟`;
}
updateCountdown();
countdownTimer = setInterval(updateCountdown, 1000);

/* -------------------------
   開啟動畫 & 顯示書本
   ------------------------- */
function openCover(){
  // cover 做個開啟動畫（加 class）
  cover.classList.add('open');
  // 等動畫結束後隱藏 cover 顯示 book
  setTimeout(()=>{
    cover.classList.add('hidden');
    book.classList.add('visible');
    book.setAttribute('aria-hidden','false');
    cover.setAttribute('aria-hidden','true');
    // 如果已過 0 頁，預設顯示最左（未翻頁）
    currentIndex = 0;
    updateControls();
  }, 800);
}

/* -------------------------
   翻頁邏輯（右→左）
   - 下一頁：把當前 index 的 page 加上 .flipped（從右往左翻）
   - 上一頁：移除上一頁的 .flipped
   ------------------------- */
function updateControls(){
  prevBtn.disabled = (currentIndex === 0);
  nextBtn.disabled = (currentIndex >= pages.length);
}
nextBtn.addEventListener('click', ()=>{
  if(currentIndex < pages.length){
    // 讓當前頁（index = currentIndex）翻過去
    pages[currentIndex].classList.add('flipped');
    currentIndex++;
    updateControls();
  }
});
prevBtn.addEventListener('click', ()=>{
  if(currentIndex > 0){
    currentIndex--;
    pages[currentIndex].classList.remove('flipped');
    updateControls();
  }
});

// 支援鍵盤：←上一頁  →下一頁
document.addEventListener('keydown', (e)=>{
  if(book.classList.contains('visible')){
    if(e.key === 'ArrowRight') nextBtn.click();
    if(e.key === 'ArrowLeft') prevBtn.click();
  }
});

// 手機滑動支援（簡易）
let touchStartX = 0;
document.addEventListener('touchstart', (e)=> touchStartX = e.changedTouches[0].clientX);
document.addEventListener('touchend', (e)=>{
  const dx = e.changedTouches[0].clientX - touchStartX;
  if(Math.abs(dx) > 40){
    if(dx < 0) nextBtn.click(); // 向左滑 = 下一頁（右→左翻）
    else prevBtn.click();
  }
});

/* -------------------------
   強制開啟（測試用）
   ------------------------- */
forceOpen.addEventListener('click', ()=> {
  clearInterval(countdownTimer);
  openCover();
});

/* -------------------------
   編輯模式（在頁面內直接編輯 .page-body）
   並可儲存到 localStorage（saveBtn）
   ------------------------- */
editToggle.addEventListener('click', ()=>{
  isEditing = !isEditing;
  $$('.page .page-body').forEach(el=>{
    el.contentEditable = isEditing ? "true" : "false";
    el.style.outline = isEditing ? "1px dashed rgba(0,0,0,.08)" : "none";
  });
  editToggle.textContent = isEditing ? "離開編輯模式" : "進入編輯模式";
});

saveBtn.addEventListener('click', ()=>{
  const arr = $$('.page .page-body').map(el=>el.innerHTML);
  localStorage.setItem('love_pages', JSON.stringify(arr));
  // 儲存開啟時間
  const v = openAtInput.value;
  if(v){
    // datetime-local 組成：`YYYY-MM-DDTHH:mm`（沒有 timezone）
    // 轉成當地時間 Date
    const d = new Date(v);
    localStorage.setItem('love_openAt', d.toString());
    targetDate = d;
    // restart countdown
    clearInterval(countdownTimer);
    updateCountdown();
    countdownTimer = setInterval(updateCountdown,1000);
  }
  alert('已儲存到此瀏覽器（localStorage）！上線後若要永久請直接修改 index.html 檔案內容。');
});

/* -------------------------
   右下 input (datetime-local) 變更時更新 targetDate 但不儲存
   ------------------------- */
openAtInput.addEventListener('change', ()=>{
  const v = openAtInput.value;
  if(v) targetDate = new Date(v);
});

/* -------------------------
   初次載入如果已過開啟時間則直接開啟（例如你已到 10/5）
   ------------------------- */
(function checkImmediateOpen(){
  const now = new Date();
  if(now >= targetDate){
    clearInterval(countdownTimer);
    setTimeout(openCover, 400);
  }
})();

/* -------------------------
   幫助：快速提示如何編輯（彈窗）
   ------------------------- */
openHelp.addEventListener('click', ()=>{
  alert('編輯教學：\n\n1) 點右下「進入編輯模式」→ 在頁面上直接修改每一頁文字。\n2) 編輯完成按「儲存內容」會存在你的瀏覽器（localStorage）。\n3) 若要永久上線，請直接修改 index.html 裡的 .page-body 文字，或上傳新的 index.html 到 GitHub Pages/Netlify 等。');
});
</script>
</body>
</html>
